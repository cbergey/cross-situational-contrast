<!DOCTYPE html>
<html>
    <head>
        <title>toma dax experiment</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
        <script src=“consent/consent.js”></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        
        <style>
            div.absolute {
                position: absolute;
                top: 500px;
                left: 400px;
                width: 500px;
                height: 50px;
            }
            
            /*
            div.container {
                position:relative;
            }

            div.displayedAlt {
                position:absolute;
                bottom: 0px;
            } 
            */

            div.displayed {
                display: block;
                margin-left: auto;
                margin-right: auto;
                /* border: 5px solid #555555 -> probably don't want to have */
            }

            #rectangle {
                width:45%;
                height:435px;
                border: 2px solid #555555;
                position:fixed;
                top:65px;
                left:350px;
            }
        </style>
    </head>
    <body>
    </body>
    <script>
        var timeline = [];

        var consent = {
            type: "external-html",
            url: "consent/consent.html",
            cont_btn: "start"
        };
        timeline.push(consent);

        var audio_instructions = {
            type: 'image-button-response', 
            stimulus: "img/speaker.png",
            stimulus_height: 375,
            stimulus_width: 375, 
            prompt: "Make sure your audio is on. Press the button above to begin.",
            choices: ['Start']
        }
        timeline.push(audio_instructions);
        
        var names = ["dax", "blicket", "wug", "toma", "gade", "sprock","koba","zorp", "flib", "boti", "quen", "lomet"];
        var shapes = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"];
        
        var colors = ["red", "blue", "green", "purple"];
        /*var sizes = ["big","small"];  just use HTML to adjust size of the image */
        var sizes = [ [500], [400], [300], [200] ] ;
        var littleSizes = [150, 200, 200, 200, 250, 250, 250, 250, 250, 300, 300, 300, 350]; /* size is 13 */
        var bigSizes = [300, 350, 350, 350, 400, 400, 400, 400, 400, 450, 450, 450, 500];

        var shuffled_little = jsPsych.randomization.shuffle(littleSizes);
        var shuffled_big = jsPsych.randomization.shuffle(bigSizes);

        var names_sample = jsPsych.randomization.sampleWithoutReplacement(names, 2);
        var shapes_sample = jsPsych.randomization.sampleWithoutReplacement(shapes, 2); 


        var left = [1, 1, 2, 2, 4, 6, 7, 7, 6, 4]
        var right = [4, 6, 7, 7, 6, 4, 2, 2, 1, 1]
        var center = [1, 2, 4, 6, 7, 7, 6, 4, 2, 1]
        var bins = [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]
        var featureextent = 0;
        var minsize = 0;
        var maxsize = 0;
        var binsize = 0

        function createBins(dist) {
            var placeindist = 0
            for (i = 0; i < dist.length; i++) {
                bins[i][0] = placeindist;
                placeindist += dist[i];
                bins[i][1] = placeindist;
            }
            featureextent = placeindist;
        }

        function getBin (number) {
            for (i = 0; i < bins.length; i++) {
                if (bins[i][0] <= number && number < bins[i][1]) {
                    return i;
                }
            }
        }

        function drawFeature(isTarget) {
            randomdraw = Math.random()*featureextent
            bin = getBin(randomdraw)
            if (isTarget) {
                minsize = 250;
                maxsize = 500;
                binsize = (maxsize - minsize)/center.length
            } else {
                minsize = 100;
                maxsize = 350;
                binsize = (maxsize - minsize)/center.length
            }
            size = (bin) * binsize + minsize + (Math.random()*binsize);
            return size;
        }

        /*
        var check = {
            type: "html-keyboard-response", 
            stimulus: shapes_sample, 
            trial_duration: 3000
        }
        timeline.push(check);  
        */
        
        var targetShape = shapes_sample[0]; /*  number */
        var targetName = names_sample[0];  /*  name */ 

        var distractorShape = shapes_sample[1];
        var distractorName = names_sample[1];

        /* first i want to have the "training phase" where people just press 
        F for some fruit and J for another fruit */

        var test_stimuli = [
            {stimulus: targetShape, name: targetName},
            {stimulus: distractorShape, name: distractorName}
        ];   /* not using */ 
        
        /* for later, if i want to separate the actual trial from the procedure
        var trial = {}
        */

        var procedure = {
            timeline: [
                /*  {
                    type:"html-keyboard-response", 
                    stimulus: targetName + chooseFruit,
                    trial_duration: chooseFruit * 1000,
                    choices: jsPsych.NO_KEYS
                }, */
                {
                    type: "html-keyboard-response", 
                    stimulus: function() {
                        /*
                        if (jsPsych.timelineVariable("name", true) == targetName) {
                            var size = shuffled_little.pop();
                        } else {
                            var size = shuffled_big.pop();
                        } */

                        /* var randNumber = Math.floor(Math.random() * 4); 
                        var size = sizes[randNumber];   */

                        createBins(center);
                        if (jsPsych.timelineVariable("name", true) == targetName) {
                            var size = drawFeature(true);
                        } else {
                            var size = drawFeature(false);
                        }

                        return "<audio src='stimsounds/" + jsPsych.timelineVariable("name", true) + ".mp3', autoplay='true'></audio>" + 
                        "<div class='displayed'>" + 
                        "<div style='width: 700px;'>" + 
                        "<div style='float: center;'>" + 
                        "<img src='stim-images/object" + jsPsych.timelineVariable("stimulus", true) + "bluebig.jpg' width='" + size + "' height='" + size + "'></img></div></div></div>" + 
                        "<div class='absolute'><p>Press F for all " + targetName + " objects. Press J for all " +  distractorName + " objects.</p></div>" + "size" + size
                        + "<div id='rectangle'></div>"
                    },
                    choices: ["f", "j"],
                    /*
                    response_ends_trial: false,
                    trial_duration: 3000,
                    */
                    post_trial_gap: 750
                }
            ],
            timeline_variables:  [
                {stimulus: targetShape, name: targetName},
                {stimulus: distractorShape, name: distractorName}
            ],
            sample: {
                type: "fixed-repetitions", 
                size: 20
            }
            /* randomize_order: true, 
            repetitions: 13  */  /* because 13 size choices for toma, 13 size choices for dax */  
        }
        timeline.push(procedure);

        var breakTime = {
            timeline: [
                {
                    type: "html-keyboard-response", 
                    stimulus: "We will now begin the testing phase. <p>Press F for " + targetName + ". Press J for " + distractorName + ".</p> <p>Press Space to begin.</p>",
                    choices: ["space"]
                }
            ]
        }
        timeline.push(breakTime);

        var testing = {
            timeline: [
                {
                    type: "html-keyboard-response", 
                    stimulus: function() {
                        var randNumber = Math.floor(Math.random() * 4);
                        var size = sizes[randNumber];
                        return "Find the " + jsPsych.timelineVariable("name", true) + ". " +  
                        "<div style='width: 700px;'>" + 
                        "<div style='float: center;'>" + 
                        "<img src='stim-images/object" + jsPsych.timelineVariable("stimulus", true) + "bluebig.jpg' width='" + size + "' height='" + size + "'></img></div></div>" + 
                            "<p>Press F for all " + targetName + " objects. Press J for all " +  distractorName + " objects.</p>" + "size" + size
                    },
                    choices: ["f", "j"],
                    post_trial_gap: 750
                }
            ],
            timeline_variables:  [
                {stimulus: targetShape, name: targetName},
                {stimulus: distractorShape, name: distractorName}
            ],
            randomize_order: true,
            repetitions: 2
        }
        timeline.push(testing);
        /* reference below for image size adjusting */
        /* return "<img style='width:100px; height:100px;' src='"+jsPsych.timelineVariable('image', true)+"'></img>";*/
        
        /*  for preloading images
        var images = ['stim-images/object' + targetShape + 'bluebig.jpg',
        "stim-images/object" + shapes_sample[3] + "bluebig.jpg",
        "stim-images/object" + shapes_sample[2] + "bluebig.jpg",
        "stim-images/object" + shapes_sample[1] + "bluebig.jpg",
        "stim-images/object" + shapes_sample[0] + "bluebig.jpg"]; */

        jsPsych.init({
            timeline: timeline,
            on_finish: function() {
                jsPsych.data.displayData();
            }
            /*preload_images: images
            default_iti: 500*/
        });
    
    </script>
</html>

