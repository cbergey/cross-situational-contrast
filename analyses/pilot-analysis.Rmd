---
title: "pilot-analysis"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(jsonlite)
library(here)
library(tidyboot)

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, 
               error = FALSE, cache = TRUE, tidy = FALSE)

theme_set(theme_classic(base_size = 18))
```


```{r read-csv}
read_file <- function(file) {

  path = paste("data/raw-data/", file, sep = "")
  csv_out <- read_csv(here(path))
  id <- str_remove(file, ".csv")
  csv_out$subid <- rep(id, nrow(csv_out))
 
 return(csv_out)
}

file_list <- list.files(path = here("data/raw-data/"), pattern = "\\.csv$")

raw_data <- map(file_list, read_file) %>%
  bind_rows() 
```

```{r data-prep}
data <- raw_data %>%
  mutate(rt = as.numeric(as.character(rt)),
         correct = as.numeric(as.logical(correct)),
         block = floor(trial_index/8),
         size_bin = floor((objSize - 100)/40),
         log_rt = log(rt))

#write.csv(data, here("data/pilot-data.csv"))
#data <- read.csv(here("data/pilot-data.csv"))

data <- data %>%
  filter(rt < 3000, rt > 100)

keep_subjs <- raw_data %>%
  filter(phase == "training", trial_name == "trial") %>%
  group_by(subid) %>%
  tidyboot_mean(correct) %>%
  filter(empirical_stat > 0.7)

training_data <- data %>%
  filter(phase == "training", trial_name == "trial", subid %in% keep_subjs$subid)

testing_data <- data %>%
  filter(phase == "testing", trial_name == "trial", subid %in% keep_subjs$subid)

```

```{r accuracy-train}
mean_training_accuracy <- training_data %>%
  group_by(block, object) %>%
  tidyboot_mean(correct)

mean_training_accuracy %>%
  ggplot(aes(x = block, y = empirical_stat, color = object)) +
  geom_line()
```

Above: Accuracy over the course of training. People get more accurate as they learn.

```{r accuracy-train-size}
training_data %>%
  group_by(size_bin, object) %>%
  tidyboot_mean(correct) %>%
  ggplot(aes(x = size_bin, y = empirical_stat, color = object)) +
  geom_point() +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))
```

Above: Accuracy in training by object size.

```{r accuracy-test}

mean_testing_accuracy <- testing_data %>%
  group_by(block, object) %>%
  tidyboot_mean(correct)

mean_testing_accuracy %>%
  ggplot(aes(x = block, y = empirical_stat, color = object)) +
  geom_line()
  
```

Above: Accuracy in testing. 

```{r accuracy-test-size}
testing_data %>%
  group_by(size_bin, object) %>%
  tidyboot_mean(correct) %>%
  ggplot(aes(x = size_bin, y = empirical_stat, color = object)) +
  geom_point() +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))
```

Above: Accuracy in testing by object size. 

```{r reaction-time-training}
training_data %>%
  group_by(block, object) %>%
  tidyboot_mean(log_rt) %>%
  ggplot(aes(x = block, y = empirical_stat, color = object)) +
  geom_line() +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))
```

Above: log reaction time over training. People get faster as they learn.

```{r reaction-time-training-size}
training_data %>%
  ggplot(aes(x = objSize, y = log_rt, color = object, alpha = 0.4)) +
  geom_point() +
  facet_wrap(~correct)
```

Above: log reaction time by object size in training.

```{r reaction-time-testing-size}
testing_data %>%
  ggplot(aes(x = objSize, y = log_rt, color = object, alpha = 0.4)) +
  geom_point() +
  facet_wrap(~correct)
```

Above: log reaction time by object size in testing.

```{r reaction-time-training-size-bin}
training_data %>%
  filter(correct == 1) %>%
  group_by(size_bin, object) %>%
  tidyboot_mean(log_rt) %>%
  ggplot(aes(x = size_bin, y = empirical_stat, color = object)) +
  geom_point() +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))
```

Above: log reaction time by binned object size in training, among correct trials.

```{r reaction-time-testing-size-bin}
testing_data %>%
  filter(correct == 1) %>%
  group_by(size_bin, object) %>%
  tidyboot_mean(log_rt) %>%
  ggplot(aes(x = size_bin, y = empirical_stat, color = object)) +
  geom_point() +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))
```

Above: log reaction time by binned object size in testing, among correct trials.

```{r acc-by-rt}
training_data %>%
  mutate(size_bin = as.factor(size_bin)) %>%
  ggplot(aes(x = size_bin, y = log_rt, color = object)) +
  geom_boxplot()

testing_data %>%
  mutate(size_bin = as.factor(size_bin)) %>%
  ggplot(aes(x = size_bin, y = log_rt, color = object)) +
  geom_boxplot() 

```